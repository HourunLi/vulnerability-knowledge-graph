import torch
import torch.nn as nn
import torch.nn.functional as F

# Define model architecture
class SetConv(nn.Module):
    def __init__(self, ent_feats, descp_feats, rel_feats, hid_units):
        super(SetConv, self).__init__()
        self.ent_mlp1 = nn.Linear(ent_feats, hid_units)
        self.ent_mlp2 = nn.Linear(hid_units, hid_units)

        self.rel_mlp1 = nn.Linear(rel_feats, hid_units)
        self.rel_mlp2 = nn.Linear(hid_units, hid_units)

        self.descp_mlp1 = nn.Linear(descp_feats, hid_units)
        self.descp_mlp2 = nn.Linear(hid_units, hid_units)
        
        self.out_mlp1 = nn.Linear(hid_units * 3, hid_units * 2)
        self.out_mlp1_ = nn.Linear(hid_units * 2, hid_units * 2)
        self.out_mlp2 = nn.Linear(hid_units * 2, ent_feats)

        self.abs_mlp = nn.Linear(ent_feats, ent_feats)
        
    def forward(self, entity, description, relation):
        """
        method 1 structure + description
        """
        hid_ent = F.leaky_relu(self.ent_mlp1(entity))
        hid_ent = F.leaky_relu(self.ent_mlp2(hid_ent))

        hid_descp = F.leaky_relu(self.descp_mlp1(description))
        hid_descp = F.leaky_relu(self.descp_mlp2(hid_descp))

        hid_rel = F.leaky_relu(self.rel_mlp1(relation))
        hid_rel = F.leaky_relu(self.rel_mlp2(hid_rel))

        hid = torch.cat((hid_ent, hid_descp, hid_rel), 1)
        hid = F.leaky_relu(self.out_mlp1(hid))
        out = self.out_mlp2(hid)

        """
        method 2 only structure
        """
        # hid_ent = F.leaky_relu(self.ent_mlp1(entity))
        # hid_ent = F.leaky_relu(self.ent_mlp2(hid_ent))

        # hid_descp = F.leaky_relu(self.descp_mlp1(description))
        # hid_descp = F.leaky_relu(self.descp_mlp2(hid_descp))

        # hid_rel = F.leaky_relu(self.rel_mlp1(relation))
        # hid_rel = F.leaky_relu(self.rel_mlp2(hid_rel))

        # hid = torch.cat((hid_ent, hid_rel), 1)
        # hid = F.leaky_relu(self.out_mlp1_(hid))
        # out = self.out_mlp2(hid)
        return out
